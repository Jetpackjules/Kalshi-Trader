<!DOCTYPE html>
<html>
<head>
    <title>Test Kalshi API for August 12, 2025</title>
    <style>
        body { font-family: monospace; padding: 20px; }
        .result { margin: 10px 0; padding: 10px; background: #f5f5f5; }
        .error { background: #ffebee; color: #c62828; }
        .success { background: #e8f5e8; color: #2e7d32; }
        pre { white-space: pre-wrap; word-wrap: break-word; }
    </style>
</head>
<body>
    <h1>üß™ Test Kalshi API - August 12, 2025 Data</h1>
    <button onclick="testAPI()">üöÄ Test Kalshi API Endpoints</button>
    <div id="results"></div>

    <script>
        function log(message, type = 'info') {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = `result ${type}`;
            div.innerHTML = `<strong>${new Date().toLocaleTimeString()}</strong>: ${message}`;
            results.appendChild(div);
            console.log(message);
        }

        async function testAPI() {
            document.getElementById('results').innerHTML = '';
            log('üîç Starting Kalshi API test for August 12, 2025...', 'info');
            
            const baseUrl = 'https://api.elections.kalshi.com/trade-api/v2';
            const targetDate = '25AUG12'; // August 12, 2025 in Kalshi format
            
            try {
                // Step 0: Check what events exist
                log('üì° Step 0: Checking available events...', 'info');
                const eventsUrl = `${baseUrl}/events?limit=100`;
                log(`Events URL: ${eventsUrl}`, 'info');
                
                try {
                    const eventsResponse = await fetch(eventsUrl);
                    if (eventsResponse.ok) {
                        const eventsData = await eventsResponse.json();
                        const events = eventsData.events || [];
                        log(`Found ${events.length} events`, 'success');
                        
                        // Look for temperature-related events
                        const tempEvents = events.filter(event => 
                            event.title?.toLowerCase().includes('temperature') ||
                            event.title?.toLowerCase().includes('nyc') ||
                            event.title?.toLowerCase().includes('temp') ||
                            event.series_ticker?.includes('KXHIGHNY')
                        );
                        
                        if (tempEvents.length > 0) {
                            log(`üå°Ô∏è Found ${tempEvents.length} temperature-related events:`, 'success');
                            tempEvents.forEach(event => {
                                log(`  - ${event.series_ticker}: ${event.title}`, 'info');
                            });
                        } else {
                            log('‚ùå No temperature events found in current events list', 'error');
                        }
                    }
                } catch (eventsError) {
                    log(`Events check failed: ${eventsError.message}`, 'error');
                }
                
                // Step 1: Get all KXHIGHNY markets
                log('üì° Step 1: Fetching all KXHIGHNY markets...', 'info');
                
                const marketsUrl = `${baseUrl}/markets?series_ticker=KXHIGHNY&limit=1000`;
                log(`URL: ${marketsUrl}`, 'info');
                
                const marketsResponse = await fetch(marketsUrl);
                log(`Response status: ${marketsResponse.status} ${marketsResponse.statusText}`, 
                    marketsResponse.ok ? 'success' : 'error');
                
                if (!marketsResponse.ok) {
                    throw new Error(`Markets API failed: ${marketsResponse.status}`);
                }
                
                const marketsData = await marketsResponse.json();
                const allMarkets = marketsData.markets || marketsData.data || [];
                log(`üìä Found ${allMarkets.length} total KXHIGHNY markets`, 'success');
                
                // Step 2: Filter for August 12 markets
                log('üîç Step 2: Filtering for August 12, 2025 markets...', 'info');
                
                const aug12Markets = allMarkets.filter(market => {
                    const ticker = market.ticker || market.id || '';
                    return ticker.includes(targetDate);
                });
                
                log(`üéØ Found ${aug12Markets.length} markets for August 12, 2025:`, 'success');
                
                if (aug12Markets.length === 0) {
                    log('‚ùå No August 12 markets found!', 'error');
                    return;
                }
                
                // Display basic market info
                aug12Markets.forEach((market, index) => {
                    log(`${index + 1}. ${market.ticker} - Status: ${market.status} - Title: ${market.title || 'N/A'}`, 'info');
                });
                
                // Step 3: Get detailed info for each market
                log('üìã Step 3: Getting detailed market information...', 'info');
                
                for (const market of aug12Markets) {
                    try {
                        const marketId = market.id || market.ticker;
                        const detailUrl = `${baseUrl}/markets/${marketId}`;
                        
                        log(`üîç Fetching details for ${market.ticker}...`, 'info');
                        
                        const detailResponse = await fetch(detailUrl);
                        if (detailResponse.ok) {
                            const marketDetail = await detailResponse.json();
                            const marketInfo = marketDetail.market || marketDetail;
                            
                            // Extract key information
                            const info = {
                                ticker: marketInfo.ticker,
                                title: marketInfo.title || marketInfo.question,
                                status: marketInfo.status,
                                result: marketInfo.result,
                                lastPrice: marketInfo.last_price,
                                yesPrice: marketInfo.yes_price,
                                noPrice: marketInfo.no_price,
                                closeTime: marketInfo.close_time,
                                resolveTime: marketInfo.resolve_time,
                                settlement: marketInfo.settlement_value,
                                resolved: marketInfo.status === 'resolved' || marketInfo.status === 'closed'
                            };
                            
                            log(`üìä ${market.ticker} Details:`, 'success');
                            log(`<pre>${JSON.stringify(info, null, 2)}</pre>`, 'info');
                            
                            // Check if this market won
                            if (info.resolved && info.result) {
                                if (info.result === 'yes' || info.result === true) {
                                    log(`üèÜ ${market.ticker} WON! This range hit on August 12.`, 'success');
                                } else {
                                    log(`‚ùå ${market.ticker} LOST. This range did not hit.`, 'error');
                                }
                            }
                            
                        } else {
                            log(`‚ùå Failed to get details for ${market.ticker}: ${detailResponse.status}`, 'error');
                        }
                        
                        // Small delay to avoid rate limiting
                        await new Promise(resolve => setTimeout(resolve, 500));
                        
                    } catch (error) {
                        log(`‚ùå Error getting details for ${market.ticker}: ${error.message}`, 'error');
                    }
                }
                
                log('‚úÖ API test completed!', 'success');
                
            } catch (error) {
                log(`‚ùå API Test failed: ${error.message}`, 'error');
                console.error('Full error:', error);
            }
        }
    </script>
</body>
</html>